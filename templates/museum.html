<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>El museo de los planetas — Chrome-style tabs</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0b1222;
    --card:#0f1724;
    --muted:#98a0b6;
    --accent:#ffd05a;
    --glass: rgba(255,255,255,0.04);
    --tab-bg:#101827;
    --tab-active:#111827;
    --radius:12px;
    font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    color: #eef2f7;
  }
  html,body{height:100%;margin:0;background:
    radial-gradient(800px 360px at 10% 10%, rgba(255,160,60,0.03), transparent 12%),
    linear-gradient(180deg,#04061a 0%, #07102b 60%); -webkit-font-smoothing:antialiased}
  header.site-header{
    padding:18px 28px;
    display:flex;gap:16px;align-items:center;justify-content:space-between;
    position:sticky;top:0;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06));
    border-bottom:1px solid rgba(255,255,255,0.03);backdrop-filter: blur(6px);z-index:40;
  }
  header h1{margin:0;font-weight:800;letter-spacing:0.6px;font-size:18px}
  header p{margin:0;color:var(--muted);font-size:13px}
  main.container{padding:28px;max-width:1200px;margin:0 auto}
  /* Chrome-like tabs row */
  .tabs {
    display:flex;
    gap:10px;
    align-items:flex-end;
    padding-left:6px;
    margin-bottom:18px;
    flex-wrap:wrap;
  }
  .tab {
    --pad-x:16px;
    background:linear-gradient(180deg,var(--tab-bg), rgba(255,255,255,0.01));
    color:var(--muted);
    padding:10px var(--pad-x);
    border-radius:9px 9px 0 0;
    border:1px solid rgba(255,255,255,0.03);
    box-shadow: 0 6px 16px rgba(0,0,0,0.45);
    cursor:pointer;
    font-weight:700;
    display:inline-flex;
    align-items:center;
    gap:10px;
    user-select:none;
    transition: transform .12s ease, box-shadow .12s;
  }
  .tab:hover{ transform: translateY(-4px) }
  .tab.active{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.006));
    color: #111827;
    background-color: var(--accent);
    border-bottom-color: transparent;
    box-shadow: 0 10px 30px rgba(0,0,0,0.6);
    transform: translateY(-2px);
  }
  /* Tab content card */
  .card {
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.008));
    border:1px solid rgba(255,255,255,0.03);
    border-radius: 0 12px 12px 12px;
    padding:18px;
    box-shadow: 0 20px 60px rgba(2,6,23,0.6);
  }
  .grid {
    display:grid;
    grid-template-columns: repeat(2, 1fr);
    gap:14px;
    margin-top:12px;
  }
  @media (min-width:980px){ .grid{ grid-template-columns: repeat(4, 1fr); } }
  .thumb {
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.006));
    border-radius:10px;
    overflow:hidden;
    border:1px solid rgba(255,255,255,0.03);
    display:flex;
    flex-direction:column;
    min-height:160px;
  }
  .thumb img{
    width:100%;
    height:150px;
    object-fit:cover;
    display:block;
    background:linear-gradient(45deg, rgba(255,255,255,0.02), rgba(0,0,0,0.03));
  }
  .thumb .meta{
    padding:10px;
    font-size:13px;
    color:var(--muted);
    display:flex;
    flex-direction:column;
    gap:6px;
  }
  .thumb .meta .title{font-weight:700;color:#fff;font-size:13px}
  .thumb .meta .logros{font-size:12px;color:var(--muted);min-height:40px}
  .small-note{font-size:12px;color:var(--muted);margin-top:10px}
  .controls{display:flex;gap:8px;align-items:center}
  .btn{background:transparent;border:1px solid rgba(255,255,255,0.03);padding:8px 12px;border-radius:8px;color:var(--muted);cursor:pointer;font-weight:700}
  .spinner{width:20px;height:20px;border-radius:50%;border:3px solid rgba(255,255,255,0.06);border-top-color:var(--accent);animation:spin 1s linear infinite;display:inline-block}
  @keyframes spin{to{transform:rotate(360deg)}}
  footer.note{margin-top:18px;color:var(--muted);font-size:13px}
  a.credit{color:var(--muted);text-decoration:underline;font-weight:600}
  /* small responsive tweaks */
  @media (max-width:640px){
    header{padding:12px}
    .tabs{gap:8px}
    .tab{padding:8px 10px;font-size:13px}
  }
</style>
</head>
<body>
  <header class="site-header" role="banner">
    <div>
      <h1>El museo de los planetas</h1>
      <p>Colección curada — imágenes oficiales NASA</p>
    </div>
    <div class="controls" aria-hidden="false">
      <button id="refreshAll" class="btn" title="Recargar todas las pestañas">Recargar todas</button>
      <div id="globalSpinner" style="display:none" class="spinner" title="Cargando..."></div>
    </div>
  </header>

  <main class="container" role="main">
    <!-- Tabs -->
    <nav class="tabs" role="tablist" aria-label="Selecciona un cuerpo">
      <!-- We'll generate tabs from JS to keep code DRY -->
    </nav>

    <!-- Content card where tab panels will render -->
    <section id="panelArea" class="card" aria-live="polite">
      <div id="panelHeader" style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
        <div>
          <h2 id="panelTitle" style="margin:0;font-size:20px;color:var(--accent)">Cargando...</h2>
          <p id="panelSubtitle" style="margin:6px 0 0 0;color:var(--muted);font-size:13px">Imágenes proporcionadas por la API de imágenes de la NASA</p>
        </div>
        <div style="display:flex;align-items:center;gap:12px">
          <button id="reloadTab" class="btn">Recargar pestaña</button>
          <div id="tabSpinner" style="display:none" class="spinner" title="Cargando..."></div>
        </div>
      </div>

      <div id="contentArea" style="margin-top:12px">
        <!-- Grid will be injected here -->
        <div id="grid" class="grid"></div>
        <p class="small-note" style="margin-top:12px">Cada imagen muestra título y una breve nota — "Logros" se extrae de los metadatos oficiales (keywords / descripción) cuando está disponible. Las fuentes son recursos oficiales de la NASA (images.nasa.gov / photojournal.jpl.nasa.gov).</p>
        <footer class="note">Créditos: Imágenes y metadatos proporcionados por <a class="credit" href="https://images.nasa.gov" target="_blank" rel="noopener noreferrer">NASA Images API</a>.</footer>
      </div>
    </section>
  </main>

    <!-- Botón flotante con ícono de casa -->
<a href="/"
   title="Ir a inicio"
   aria-label="Inicio"
   style="
     position: fixed;
     bottom: 25px;
     right: 25px;
     width: 60px;
     height: 60px;
     background: #111;
     color: #ffffff;
     display: flex;
     align-items: center;
     justify-content: center;
     border-radius: 50%;
     box-shadow: 0 6px 18px rgba(3, 37, 65, 0.28);
     cursor: pointer;
     text-decoration: none;
     transition: all 0.2s ease;
     z-index: 9999;
   "
   onmouseover="this.style.transform='scale(1.08)'; this.style.boxShadow='0 10px 25px rgba(3,37,65,0.35)';"
   onmouseout ="this.style.transform='scale(1)'; this.style.boxShadow='0 6px 18px rgba(3,37,65,0.28)';"
   onfocus  ="this.style.outline='3px solid rgba(2,132,199,0.25)'; this.style.transform='scale(1.08)';"
   onblur   ="this.style.outline='none'; this.style.transform='scale(1)';"
>
  <svg xmlns="http://www.w3.org/2000/svg"
       width="30" height="30" viewBox="0 0 24 24" fill="none"
       stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
       style="display:block;">
    <path d="M3 9.5L12 3l9 6.5V21a1 1 0 0 1-1 1h-5v-6H9v6H4a1 1 0 0 1-1-1V9.5z"/>
  </svg>
</a>

<script>
/*
  Plantilla completa: Chrome-style tabs + fetch dinámico de imágenes oficiales NASA.

  - Pestañas predeterminadas (9): Luna, Mercurio, Venus, Tierra, Marte, Júpiter, Saturno, Urano, Neptuno
  - Por cada pestaña se intentan traer 4 imágenes desde la NASA Images API:
      https://images-api.nasa.gov/search?q=...&media_type=image
  - Mostramos título, fuente (link a la página de la NASA) y una sección "Logros" basada en keywords / descripción.
  - Esto evita que el asistente tenga que incrustar URLs fijas y garantiza que las imágenes provengan directamente de recursos oficiales NASA.
  - Si quieres imágenes y textos concretos preseleccionados, indícalo y puedo adaptar la búsqueda por PIA / nasa_id.
*/

/* ----- CONFIG ----- */
const BODIES = [
  { id: 'moon',  label: 'Luna',        q: 'Moon' },
  { id: 'mercury', label: 'Mercurio',  q: 'Mercury MESSENGER' },
  { id: 'venus', label: 'Venus',      q: 'Venus Magellan' },
  { id: 'earth', label: 'Tierra',     q: 'Earth Blue Marble' },
  { id: 'mars', label: 'Marte',       q: 'Mars Curiosity Perseverance' },
  { id: 'jupiter', label: 'Júpiter',  q: 'Jupiter Juno' },
  { id: 'saturn', label: 'Saturno',   q: 'Saturn Cassini' },
  { id: 'uranus', label: 'Urano',     q: 'Uranus Voyager 2' },
  { id: 'neptune', label: 'Neptuno',  q: 'Neptune Voyager 2' }
];

const IMAGES_PER_TAB = 4;
const NASA_API_BASE = 'https://images-api.nasa.gov/search';

/* ----- DOM refs ----- */
const tabsContainer = document.querySelector('.tabs');
const panelTitle = document.getElementById('panelTitle');
const panelSubtitle = document.getElementById('panelSubtitle');
const grid = document.getElementById('grid');
const panelSpinner = document.getElementById('tabSpinner');
const globalSpinner = document.getElementById('globalSpinner');
const reloadTabBtn = document.getElementById('reloadTab');
const refreshAllBtn = document.getElementById('refreshAll');

let activeTab = null;
let cache = {}; // simple in-memory cache of results per body id

/* ----- Utility helpers ----- */
function el(tag, attrs={}, ...children){
  const e = document.createElement(tag);
  for(const k in attrs){
    if(k === 'class') e.className = attrs[k];
    else if(k === 'html') e.innerHTML = attrs[k];
    else e.setAttribute(k, attrs[k]);
  }
  for(const ch of children) if(ch) e.appendChild(typeof ch === 'string'? document.createTextNode(ch) : ch);
  return e;
}

function showSpinner(which, show=true){
  const el = which === 'global' ? globalSpinner : panelSpinner;
  el.style.display = show ? 'inline-block' : 'none';
}

/* ----- NASA fetch logic ----- */
/*
  We'll call the NASA Images API with the query and request JSON.
  We prefer results that include links[].href (thumbnails/full images).
*/
async function fetchNASAImages(query, limit=IMAGES_PER_TAB){
  const url = `${NASA_API_BASE}?q=${encodeURIComponent(query)}&media_type=image`;
  const resp = await fetch(url);
  if(!resp.ok) throw new Error('Error al llamar la API NASA: ' + resp.status);
  const json = await resp.json();
  // collection.items is an array. Each item has data[] and links[] (sometimes links missing)
  const items = (json.collection && json.collection.items) ? json.collection.items : [];
  // prepare a small list of sanitized cards: { title, description, href (image), nasa_page (href data link), keywords }
  const cards = [];
  for(const it of items){
    if(cards.length >= limit) break;
    const data = (it.data && it.data[0]) ? it.data[0] : null;
    const link = (it.links && it.links[0] && it.links[0].href) ? it.links[0].href : null;
    // If no link present, skip; sometimes there are items with only asset endpoint
    if(!link) continue;
    const card = {
      title: data && data.title ? data.title : (data && data.nasa_id ? data.nasa_id : 'Sin título'),
      description: data && data.description ? data.description : '',
      keywords: Array.isArray(data && data.keywords) ? data.keywords : [],
      photographer: data && data.photographer ? data.photographer : (data && data.secondary_creator ? data.secondary_creator : ''),
      image: link,
      // try to link to the item's NASA page (nasa_id uses the search endpoint to build a page)
      nasa_id: data && data.nasa_id ? data.nasa_id : null,
      nasa_page: data && data.nasa_id ? `https://images.nasa.gov/details-${encodeURIComponent(data.nasa_id)}` : null
    };
    cards.push(card);
  }
  return cards;
}

/* ----- DOM rendering ----- */

function renderTabs(){
  tabsContainer.innerHTML = '';
  BODIES.forEach((b, idx) => {
    const t = el('button', { class: 'tab', role:'tab', 'data-id': b.id, title: b.label }, b.label);
    t.addEventListener('click', ()=> activateTab(b.id));
    tabsContainer.appendChild(t);
    // set first active by default
    if(idx === 0) activeTab = b.id;
  });
  // set the first active visually and load it
  setActiveVisual(activeTab);
}

function setActiveVisual(id){
  Array.from(tabsContainer.children).forEach(btn=>{
    if(btn.dataset.id === id) btn.classList.add('active');
    else btn.classList.remove('active');
  });
}

/* Build "Logros" text from metadata heuristics */
function buildLogrosText(card, bodyLabel){
  // Prefer keywords if any and short
  if(card.keywords && card.keywords.length){
    // take up to 5 keywords and join
    const k = card.keywords.slice(0,5).join(', ');
    return `Logros / etiquetas: ${k}`;
  }
  // fallback: look into description and pull a short sentence
  if(card.description && card.description.length){
    // take first 140 chars, end at a full stop if present
    const idx = card.description.indexOf('.');
    if(idx > 40) return 'Logros: ' + card.description.slice(0, Math.min(140, idx + 1)).trim();
    return 'Logros: ' + card.description.slice(0, 140).trim() + (card.description.length>140? '…':'');
  }
  // fallback generic achievements per body (brief)
  const generic = {
    'Luna': 'Llegada de misiones tripuladas (Apollo), mapeo por LRO, aterrizajes y rovers (sondas).',
    'Mercurio': 'Sobrevuelos y mapeo por MESSENGER — mejora del conocimiento de la superficie y campo magnético.',
    'Venus': 'Radar y sondas Magellan / Venera — mapeo y análisis atmosférico.',
    'Tierra': 'Observación global — estaciones, clima, y teledetección (Blue Marble).',
    'Marte': 'Rovers, orbitadores y detección de agua pasada; múltiples aterrizajes exitosos.',
    'Júpiter': 'Misiones Juno/Galileo — mapeo de atmósfera y campo magnético; descubrimiento de lunas.',
    'Saturno': 'Cassini: descubrimiento de geología de Titán, anillos y composición atmosférica.',
    'Urano': 'Explorado por Voyager 2 — descubrimiento de inclinación extrema y anillos.',
    'Neptuno': 'Voyager 2: descubrimiento de lunas y atmósfera con fuertes vientos.'
  };
  return 'Logros: ' + (generic[bodyLabel] || 'Exploraciones y datos científicos disponibles en recursos NASA.');
}

function renderGrid(cards, bodyLabel){
  grid.innerHTML = '';
  if(!cards || cards.length === 0){
    grid.appendChild(el('p', { class:'small-note' }, 'No se encontraron imágenes oficiales para esta búsqueda.'));
    return;
  }
  cards.forEach(card => {
    const thumb = el('article', { class: 'thumb' });
    const img = el('img', { src: card.image, alt: card.title });
    // click opens NASA image page in new tab (prefer official landing when possible)
    img.style.cursor = 'pointer';
    img.addEventListener('click', ()=>{
      if(card.nasa_page) window.open(card.nasa_page, '_blank', 'noopener');
      else window.open(card.image, '_blank', 'noopener');
    });

    const meta = el('div', { class: 'meta' },
      el('div', { class: 'title' }, card.title),
      el('div', { class: 'logros' }, buildLogrosText(card, bodyLabel)),
      el('div', { class: 'small' }, 
         el('a', { href: card.nasa_page || card.image, target: '_blank', rel:'noopener noreferrer', class:'credit' }, 'Fuente NASA'))
    );

    thumb.appendChild(img);
    thumb.appendChild(meta);
    grid.appendChild(thumb);
  });
}

/* ----- Activation / loading flow ----- */
async function activateTab(id){
  if(activeTab === id && cache[id]) return; // already active and cached
  activeTab = id;
  setActiveVisual(id);
  // update header
  const bodyConf = BODIES.find(b=>b.id===id);
  panelTitle.textContent = bodyConf ? bodyConf.label : id;
  panelSubtitle.textContent = `Buscando imágenes oficiales NASA para "${bodyConf.q}" — ${IMAGES_PER_TAB} resultados.`;
  // show spinner
  showSpinner('panel', true);
  try {
    let cards;
    if(cache[id]) {
      cards = cache[id];
    } else {
      cards = await fetchNASAImages(bodyConf.q, IMAGES_PER_TAB);
      // store cache (basic)
      cache[id] = cards;
    }
    renderGrid(cards, bodyConf.label);
  } catch(err){
    grid.innerHTML = '';
    grid.appendChild(el('p', { class:'small-note' }, `Error al cargar imágenes: ${err.message}`));
    console.error(err);
  } finally {
    showSpinner('panel', false);
  }
}

/* ----- Global controls ----- */
reloadTabBtn.addEventListener('click', async () => {
  if(!activeTab) return;
  // clear cache for this tab and reload
  delete cache[activeTab];
  await activateTab(activeTab);
});

refreshAllBtn.addEventListener('click', async () => {
  cache = {};
  showSpinner('global', true);
  // reload active tab after clearing
  try {
    await activateTab(activeTab);
  } finally {
    showSpinner('global', false);
  }
});

/* ----- Init ----- */
(function init(){
  renderTabs();
  // activate the first tab (default)
  activateTab(activeTab);
})();
</script>
</body>
</html>
